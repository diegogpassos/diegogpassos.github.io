<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>-</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="dns">DNS</h1>
<p>O DNS é um serviço essencial para o bom funcionamento da Internet atual. Sem ele, usuários seriam obrigados a, de alguma forma, conhecer os <em>hosts</em> com os quais desejam se comunicar pelos seus endereços IP, algo bem mais difícil de se decorar que os nomes de <em>host</em> sugestivos que geralmente são atribuídos na Internet.</p>
<p>A importância do DNS, no entanto, excede esse simples mapeamento de nomes e endereços IP. Na prática, o serviço de DNS viabiliza funcionalidades importantes, como o balanceamento de carga entre servidores de um mesmo serviço e a determinação de qual <em>host</em> é responsável por determinados serviços de um domínio.</p>
<p>Ao longo desse material, veremos várias demonstrações que ilustram essas e outras propriedades do DNS.</p>
<h2 id="balanceamento-de-carga">Balanceamento de Carga</h2>
<p>Com a popularização da Internet, o balanceamento de carga passou a ser uma estratégia importante adotada por vários serviços e aplicações. A ideia é manter vários servidores físicos capazes de servir uma mesma aplicação. À medida que novos clientes tentam acessar o sistema, eles são, de alguma forma, distribuídos automaticamente pelos vários servidores. É comum, ainda, que esses mecanismos identifiquem a posição geográfica aproximada do cliente e atribuam-no a um servidor que seja próximo.</p>
<p>Há várias estratégias utilizadas na Internet para a implementação desse tipo de balanceamento — muitas vezes, diversas estratégias são combinadas, provendo múltiplos níveis de balanceamento. Uma dessas possibilidades utiliza o DNS. Nesse caso, todos os servidores disponíveis — <em>hosts</em> diferentes, cada um com seu endereço IP — são associados a um mesmo nome de <em>host</em>. Quando um cliente realiza uma consulta ao DNS para resolver esse nome de <em>host</em> em um endereço IP, o próprio servidor DNS pode responder com o endereço IP do servidor mais <em>adequado</em> — <em>e.g.</em>, com menor carga ou mais próximo geograficamente do cliente.</p>
<p>No vídeo abaixo, vemos um exemplo disso na prática:</p>
<p><video src="videos/balanceamento.mp4" controls=""><a href="videos/balanceamento.mp4">Video</a></video></p>
<p>Nessa demonstração, vemos dois terminais de linha de comando. Enquanto o terminal da esquerda é executado no computador local, o da direita corresponde a uma sessão de <em>shell</em> remoto em outro <em>host</em>. Em um primeiro momento, no terminal da esquerda, executa-se um comando <code>ping</code> especificando-se como destino o <em>host</em> <code>www.google.com</code>. Antes de efetivamente enviar seus pacotes, o <code>ping</code> precisa resolver esse nome no endereço IP associado. A saída do comando mostra o resultado desse processo de resolução: o IP <code>172.217.30.4</code>.</p>
<p>Na sequência da demonstração, o mesmo comando é repetido no terminal da direita — <em>i.e.</em>, aquele executado no servidor. Embora o resultado seja similar — o <em>ping</em> é bem-sucedido —, é interessante observar que essa segunda execução obtém um endereço diferente como resultado da resolução DNS: <code>172.217.29.100</code>. Essa diferença é justamente uma manifestação do balanceamento de carga, nesse caso auxiliado pelo DNS.</p>
<h2 id="aliases">Aliases</h2>
<p>Na seção anterior, vimos um exemplo de um mesmo nome associado à diversos IPs diferentes. O DNS também dá suporte à situação oposta: um mesmo IP associado a múltiplos nomes. Mais especificamente, um <em>host</em> possui um <strong>nome canônico</strong> — algo como um nome “oficial” — e, possivelmente, vários apelidos (ou <em>aliases</em>, em inglês).</p>
<p>O vídeo abaixo mostra um exemplo:</p>
<p><video src="videos/aliases.mp4" controls=""><a href="videos/aliases.mp4">Video</a></video></p>
<p>Nele, vemos duas execuções do comando <code>ping</code>: uma destinada ao <em>host</em> <code>mesbla.midiacom.uff.br</code> e outra destinada ao <em>host</em> <code>www.midiacom.uff.br</code>. O ponto mais importante a se observar aqui são os endereços IP reportados pelo <code>ping</code> resultantes do processo de resolução DNS: o mesmo IP é retornado em ambas as execuções, ilustrando que ambos os nomes estão associados a um mesmo <em>host</em>.</p>
<p>Apelidos são bastante usados para prover nomes potencialmente significativos para os vários contextos em que um determinado <em>host</em> pode ser referenciado. No exemplo acima, o <em>host</em> <code>mesbla.midiacom.uff.br</code> hospeda o <em>site</em> principal do domínio <code>midiacom.uff.br</code>. Historicamente, servidores <em>web</em> costumam receber o nome <code>www</code>. Assim, os administradores desse domínio optaram por criar um <em>alias</em> <code>www</code> apontando para o <em>host</em> <code>mesbla</code>. Uma vantagem de se fazer isso é que, se em determinado momento, o servidor <em>web</em> for migrado para outro <em>host</em>, o <em>alias</em> será removido — ou, mais precisamente, atribuído ao outro <em>host</em> —, mas a máquina antiga manterá seu nome canônico. Além disso, se um mesmo <em>host</em> é servidor de várias aplicações diferentes — <em>web</em> e e-mail, por exemplo — podemos atribuir <em>aliases</em> diferentes para essa mesma máquina associados a cada serviço particular — <em>e.g.</em>, <code>www.midiacom.uff.br</code> e <code>mail.midiacom.uff.br</code>. Além de mais descritivos, esses apelidos podem ser alterados independentemente caso um ou mais serviços sejam migrados para um novo <em>host</em>.</p>
<h2 id="tld">TLD</h2>
<p>Nomes de <em>host</em> na Internet são estruturados em níveis associados à estrutura de domínios e sub-domínios. No nível mais alto dessa hierarquia, estão os <em>Top-Level Domains</em>, ou TLDs. Até alguns anos atrás, a lista de TLDs da Internet era relativamente restrita. Em 2008, o ICANN<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> iniciou um processo para a introdução de novos gTLDs (<em>generic TLDs</em>): domínios TLD de propósito geral, em oposição aos utilizados para denotar países ou classes específicas (<em>e.g.</em>, <code>.mil</code>, <code>.edu</code>). Em quatro anos, o ICANN recebeu cerca de 2000 pedidos de registros de gTLDs, vários dos quais foram efetivamente aceitos e implementados. Atualmente, há cerca de 1500 TLDs registrados na base da IANA.</p>
<p>A partir desse processo de introdução dos novos gTLDs, grandes empresas de diversos setores, como Google, Apple, Itau e Bradesco, conseguiram registrar um ou mais TLDs. Dessa forma, essas empresas tem autonomia para atribuir nomes como <code>internetbanking.itau</code> ou <code>about.google</code>, por exemplo, embora o uso desse tipo de nome ainda seja relativamente raro.</p>
<p>Mesmo assim, é possível identificar ocorrências desses novos gTLDs na Internet. O vídeo abaixo, por exemplo, ilustra o uso de três TLDs pela Google: o <code>.com</code>, o <code>.gle</code> e o <code>.google</code>:</p>
<p><video src="videos/TLD.mp4" controls=""><a href="videos/TLD.mp4">Video</a></video></p>
<p>No início do vídeo, vemos uma tentativa de acessar a URL <code>http://goo.gle/</code>. Essa URL é digitada na barra de endereços de um <em>browser</em> que, em seguida, abre a página inicial da ferramenta de busca da Google. Note que quando a página é renderizada a URL na barra de endereços muda: ela deixa de ser <code>http://goo.gle/</code> e passa a ser <code>https://www.google.com/</code>.</p>
<p>Repare, no entanto, que essa alteração não foi feita de maneira autônoma pelo <em>browser</em> — <em>i.e.</em>, o <em>browser</em> não assumiu que o usuário cometeu um erro de digitação ao tentar digitar <code>google</code>. Isso pode ser observado por volta de 0:28: o <em>browser</em> efetivamente fez uma requisição do tipo <code>GET</code> para um <em>host</em> denominado <code>goo.gle</code>, mas recebeu como resposta um código de <em>status</em> <code>301</code>. Através desse código, o servidor em <code>goo.gle</code> indica ao <em>browser</em> que o conteúdo requisitado foi movido permanentemente para outra URL. Conforme mostrado em 0:33, essa URL é informada nos cabeçalhos da resposta: <code>https://www.google.com/</code>. É esse pedido de redireção que faz com que o <em>browser</em> altere a URL na barra de endereços. De posse dessa nova localização para o objeto requisitado, o <em>browser</em> gera uma série de requisições para obter todos os elementos necessários à renderização da página.</p>
<p>Uma outra forma de vermos que o TLD <code>.gle</code> existe — e, em particular, que ele contém um <em>host</em> chamado <code>goo</code> — é mostrada logo a seguir no vídeo. Usando o comando <code>host</code>, executa-se uma consulta ao DNS relativa ao <em>hostname</em> <code>goo.gle</code>. Essa consulta é bem-sucedida, retornando dois endereços IP associados a esse nome. Para efeito de comparação, o vídeo mostra também o mesmo tipo de consulta, mas agora para o <em>hostname</em> <code>www.google.com</code>. Note que essa segunda consulta também é bem-sucedida, mas retorna outro endereço IP, sugerindo que provavelmente se trata de <em>hosts</em> diferentes.</p>
<p>Como um último experimento, o vídeo mostra ainda uma tentativa de comunicação — através do comando <code>ping</code> — com um <em>host</em> denominado <code>about.google</code>. Repare que o <em>ping</em> funciona: o comando consegue resolver o nome no endereço IP <code>216.239.32.29</code> e obtém respostas desse <em>host</em>. Além disso, o vídeo mostra o resultado de uma consulta DNS a esse <em>hostname</em> utilizando o comando <code>host</code> que, novamente, confirma a existência desse nome.</p>
<p>De fato, os domínios <code>.gle</code> e <code>.google</code> são TLDs registrados pela IANA. Seus registros foram solicitados pela Google no âmbito do processo de expansão dos gTLDs iniciado em 2008. O TLD <code>.gle</code> é usado pela Google para gerar versões pequenas URLs. Para isso, a Google registrou um <em>host</em> denominado <code>goo</code> dentro desse domínio. Já o TLD <code>.google</code> contém alguns <em>hostnames</em> relativos, principalmente, a sites com informações institucionais da empresa.</p>
<h2 id="registrando-um-domínio">Registrando um Domínio</h2>
<p>A criação de novos domínios é uma atividade relativamente comum na Internet, principalmente nos níveis mais baixos da hierarquia. Por exemplo, quando uma determinada entidade é criada, ela pode ter o interesse em criar um site e/ou outros serviços institucionais que sejam hospedados sob um domínio próprio, como forma de reforçar a marca.</p>
<p>Para que um novo domínio seja criado, o primeiro passo é contactar a entidade responsável pelo gerenciamento do domínio dentro do qual se deseja criar o novo sub-domínio. Por exemplo, no Brasil, o domínio <code>.com.br</code> é gerido pelo <em>Registro.br</em>. Além dos aspectos burocráticos associados ao registro de um sub-domínio — <em>e.g.</em>, valores pagos, documentos comprobatórios — , é necessário fornecer uma série de dados técnicos para que o registro seja bem sucedido. Nessa seção, veremos quais são as principais informações necessárias, utilizando como exemplo o domínio <code>uff.br</code>.</p>
<p>Para ilustrar esses conceitos, utilizaremos a pequena demonstração vista no vídeo abaixo:</p>
<p><video src="videos/RegistroDeDominio.mp4" controls=""><a href="videos/RegistroDeDominio.mp4">Video</a></video></p>
<p>O vídeo utiliza uma ferramenta de linha de comando denominada <code>dig</code> capaz de realizar vários tipos de consultas ao DNS. A primeira consulta realizada busca registros do tipo <code>NS</code> associados ao nome <code>uff.br</code>. A saída impressa pelo <code>dig</code> é um pouco verbosa, mas o trecho importante são as três linhas da <em>ANSWER SECTION</em> (a seção de resposta). Elas mostram três registros encontrados: cada um corresponde ao <strong><em>hostname</em> de um servidor DNS autoritativo para o domínio <code>uff.br</code></strong>.</p>
<p>Esse é justamente o primeiro passo para o registro de um novo domínio: cadastram-se um ou mais servidores DNS autoritativos para o novo domínio. Esses registros são armazenados no servidor DNS autoritativo do domínio imediatamente acima na hierarquia — no exemplo do vídeo, o TLD <code>.br</code>. Esse tipo de informação é armazenada em um registro do tipo <code>NS</code>. É importante notar que o valor armazenado em um registro <code>NS</code> é o <strong>nome</strong> do <em>host</em> que atua como servidore autoritativo do domínio em questão, e não seu endereço IP.</p>
<p>Por esse motivo, o próximo passo para o registro do novo domínio é criar registros do tipo <code>A</code> mapeando os nomes de cada servidor de DNS registrado no passo anterior ao seu respectivo IP. No vídeo acima, isso é ilustrado a partir do instante 0:19, quando uma segunda consulta é realizada, agora buscando-se um registro do tipo <code>A</code> associado ao nome <code>server.uff.br</code>. Essa consulta retorna o endereço IP <code>200.20.0.18</code>. Note que esse registro é armazenado também pelo servidor do domínio imediatamente acima na hierarquia (no exemplo do vídeo, o <code>.br</code>).</p>
<p>A partir desse ponto, já é possível a adição de <em>hostnames</em>, sub-domínios ou outros tipos de registro no âmbito do domínio recém-criado. No entanto, a criação desses elementos é feita diretamente nos servidores de DNS autoritativos do novo domínio, não necessitando mais de inclusões de registros nos servidores DNS do domínio imediatamente acima.</p>
<h2 id="dns-e-e-mail">DNS e E-mail</h2>
<p>Há uma funcionalidade interessante e essencial do DNS que, por vezes, passa despercebida: o mapeamento de servidores de e-mail. Dentre os vários tipos de registro suportados pelo DNS, está o tipo <code>MX</code>. Registros do tipo <code>MX</code> associam um <strong>nome de domínio</strong> ao <strong>nome de um servidor</strong> responsável pelo serviço de e-mail daquele domínio. É comum a existência de diversos servidores redundantes de e-mail em um mesmo domínio. Nesse caso, serão encontradas múltiplas entradas do tipo <code>MX</code> para aquele domínio.</p>
<p>Conforme ilustrado no vídeo abaixo, isso é útil para descobrirmos qual é o servidor de e-mail do destinatário de uma mensagem para o posterior estabelecimento de uma conexão SMTP. Suponha, por exemplo, que o servidor de e-mail de um determinado remetente precisa enviar uma mensagem destinada ao endereço <code>dpassos@ic.uff.br</code>. Isolando o domínio <code>ic.uff.br</code> do resto do endereço, podemos fazer uma consulta a esse nome filtrando por domínios do tipo <code>MX</code>.</p>
<p><video src="videos/MX.mp4" controls=""><a href="videos/MX.mp4">Video</a></video></p>
<p>Conforme mostrado no vídeo, essa consulta retorna vários resultados, os nomes de 7 servidores alternativos. Podemos selecionar um desses nomes e realizar uma consulta do tipo <code>A</code>, obtendo, assim, o endereço IP do servidor desejado.</p>
<p>Apenas a título de ilustração, no vídeo acima, utiliza-se o comando <code>telnet</code> para abrir uma conexão TCP para a porta 25 do <em>host</em> associado ao endereço IP obtido. Quando a conexão é estabelecida, o servidor imediatamente envia uma mensagem de apresentação, comprovando que se trata de fato de um servidor SMTP.</p>
<p>É interessante notar no exemplo do vídeo que os nomes dos servidores de e-mail do domínio <code>ic.uff.br</code> estão todos no domínio <code>googlemail.com</code>. De fato, atualmente o IC terceiriza o seu serviço de e-mail que é efetivamente implementado pela Google. Isso é uma alternativa cada vez mais comum e ilustra uma propriedade interessante dos registros MX: o servidor de e-mail de certo domínio não precisa possuir um <em>hostname</em> daquele domínio.</p>
<h2 id="respostas-autoritativas-e-não-autoritativas">Respostas Autoritativas e Não-Autoritativas</h2>
<p>Finalizando esse material, nessa seção discutiremos os conceitos de respostas <em>autoritativas</em> e <em>não-autoritativas</em>.</p>
<p>Uma das características marcantes do DNS é sua natureza distribuída: trata-se de uma grande base de dados na qual porções das informações armazenadas são divididas pelos vários servidores existentes na Internet. Em um primeiro nível, a maneira como esses dados são distribuídos está intimamente ligada à hierarquia de domínios e sub-domínios. Em particular cada (sub-)domínio contém um ou mais servidores DNS <strong>autoritativos</strong> responsáveis por armazenar entradas pertinentes àquele domínio específico.</p>
<p>Entretanto, como forma de evitar repetidas consultas aos servidores autoritativos, é comum que servidores de DNS façam <em>cache</em> de registros de outros domínios. Assim, se um cliente deseja resolver um determinado nome, é possível que um servidor DNS da sua rede local seja capaz de responder, ao invés de necessariamente ser obrigado a consultar o servidor autoritativo do domínio associado ao <em>host</em>.</p>
<p>A existência dessas <em>caches</em> distribuídas pelos vários servidores de DNS da Internet é, certamente, benéfica em geral, mas também traz alguns inconvenientes. O maior problema é a possibilidade de inconsistências nas informações armazenadas por diferentes servidores. Isso pode ocorrer quando uma entrada é alterada no servidor autoritativo de um domínio — por exemplo, para mapear o nome <code>www</code> para um <em>host</em> diferente quando da alteração de um servidor <em>web</em>. Quando isso ocorre, é possível que o mapeamento antigo ainda esteja armazenado em <em>caches</em> de servidores DNS espalhados pelo mundo, que, durante algum tempo<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, entregarão respostas incorretas quando consultados.</p>
<p>Isso afeta particularmente os vários serviços de <em>nome de host dinâmico</em> na Internet atualmente. Esses serviços permitem que <em>hosts</em> que possuam endereço IP dinâmico — <em>i.e.</em>, que não mantém um mesmo endereço permanente, algo comum para usuários residenciais, por exemplo — sejam conhecidos por um <em>hostname</em> fixo na Internet. Assim, independentemente do seu endereço IP atual, esse <em>host</em> pode ser “encontrado” por outros <em>hosts</em> da Internet através de uma simples consulta DNS.</p>
<p>Esses serviços fornecem ao usuário um pequeno programa que monitora permanentemente o endereço (dinâmico) do <em>host</em>. Toda vez que o programa detecta uma mudança no endereço, ele contacta o servidor do serviço e comunica a alteração. Isso dispara uma alteração no registro que faz o mapeamento entre aquele nome de <em>host</em> e o seu IP atual no servidor DNS autoritativo do domínio mantido pelo serviço. Por alguns minutos — ou mesmo horas, a depender da agressividade da política de cache utilizada nos vários servidores de DNS do mundo — é possível que a versão anterior desse mapeamento permaneça na <em>cache</em> desses outros servidores, impossibilitando acesso ao <em>host</em>.</p>
<p>É nesse contexto que surge a importância do conceito de <strong>resposta autoritativa</strong>. Uma resposta autoritativa é aquela gerada pelo servidor autoritativo do domínio referente à consulta realizada. O vídeo abaixo ilustra esse conceito:</p>
<p><video src="videos/RespAutoritativa.mp4" controls=""><a href="videos/RespAutoritativa.mp4">Video</a></video></p>
<p>No início do vídeo, utiliza-se o comando <code>dig</code> para fazer uma consulta por um registro do tipo <code>A</code> referente ao nome <code>www.uff.br</code>. O <code>dig</code> retorna uma resposta contendo o mapeamento entre esse nome e o endereço IP <code>200.20.0.18</code>. Entretanto, consultando os cabeçalhos da resposta recebida, vemos que o servidor especificou o campo <code>authority</code> com valor 0. Isso significa que o servidor que está respondendo — nesse caso, um servidor DNS local usado apenas para intermediar os processos de resolução do <em>host</em> utilizado no vídeo — está declarando que ele <strong>não é o</strong> servidor autoritativo do domínio <code>uff.br</code>. Dessa forma, é <em>possível</em> que a resposta recebido esteja defesada — <em>i.e.</em>, que o mapeamento tenha sido recentemente alterado no servidor autoritativo.</p>
<p>É possível verificar essa resposta com o próprio servidor autoritativo. Para isso, basta enviarmos a requisição diretamente para esse servidor, ao invés de enviarmos para o servidor local. Isso é feito na sequência do vídeo, quando uma nova execução do comando <code>dig</code> é feita utilizando o parâmetro <code>@200.20.0.18</code>. Esse IP especificado após o caractere <code>@</code> é o IP de um dos servidores autoritativos do domínio <code>uff.br</code> — você consegue lembrar como podemos obter essa informação? — e vemos que o resultado do comando é, novamente, a obtenção de um mapeamento entre o nome <code>www.uff.br</code> e o IP <code>200.20.0.18</code>. No entanto, agora temos certeza de que esse mapeamento é o correto atualmente, porque essa resposta é autoritativa.</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>O ICANN (<em>Internet Corporation for Assigned Names and Numbers</em>) é uma entidade responsável pela manutenção de uma série de bases de numerações e nomes utilizadas na Internet. Mais especificamente, a criação e gerência de TLDs e outros aspectos dos níveis mais altos do DNS são efetuados pela <em>Internet Assigned Numbers Authority</em> (IANA), uma organização sob a administração do ICANN.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Quando um servidor DNS armazena uma entrada em <em>cache</em>, um tempo de validade é especificado. Após esse tempo, a informação é expurgada e, se necessário, o mapeamento é novamente consultado a partir de outro servidor.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</body>
</html>
